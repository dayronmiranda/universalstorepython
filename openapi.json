{
  "openapi": "3.0.3",
  "info": {
    "title": "JollyTienda API",
    "version": "1.0.0",
    "description": "Complete API for the JollyTienda e-commerce platform.\n\n## Authentication\nThe API supports the following authentication methods:\n- **JWT Bearer Token**: For authenticated users (Magic Link)\n- **Internal Service**: Header `x-service-secret` for internal service communication\n\n## Roles\n- `client`: Customer/buyer\n- `support`: Support agent\n- `product_manager`: Product manager\n- `admin`: Full administrator\n",
    "contact": {
      "name": "JollyTienda API Support",
      "url": "https://www.jollytienda.com"
    },
    "license": {
      "name": "Proprietary"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000/api",
      "description": "Local development"
    },
    {
      "url": "https://api.jollytienda.com/api",
      "description": "Production"
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Unified authentication - Login, logout, magic links, sessions"
    },
    {
      "name": "Users",
      "description": "User management, profiles and customers"
    },
    {
      "name": "Products",
      "description": "Product catalog, categories and stock"
    },
    {
      "name": "Orders",
      "description": "Orders, cart, payments and returns"
    },
    {
      "name": "Payments",
      "description": "Payment processing, checkout, refunds and transactions"
    },
    {
      "name": "Support",
      "description": "Support system, chat and communications"
    },
    {
      "name": "Admin",
      "description": "Administration - Users, configuration, media, database"
    },
    {
      "name": "Health",
      "description": "Health checks and monitoring"
    }
  ],
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "paths": {
    "/auth/magic-link": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Request magic link (all users)",
        "description": "Sends a magic link to the email for authentication. Works for all user types (client, support, product_manager, admin). Frontend redirects based on user role.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "user@example.com"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Link sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "429": {
            "$ref": "#/components/responses/TooManyRequests"
          }
        }
      }
    },
    "/auth/verify": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Verify magic link",
        "description": "Verifies the magic link token and returns JWT + httpOnly cookie.\n\nThe JWT contains the user role, allowing frontend to redirect:\n- Admin roles (admin, support, product_manager) \u2192 Admin dashboard\n- Client role \u2192 Storefront",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token"
                ],
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Magic link token (received by email)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Authentication successful",
            "headers": {
              "Set-Cookie": {
                "description": "HttpOnly cookie with JWT token (auth_token)",
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        },
                        "token": {
                          "type": "string",
                          "description": "JWT token"
                        },
                        "needsProfile": {
                          "type": "boolean",
                          "description": "Whether the user needs to complete their profile"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "Get current user",
        "description": "Returns the authenticated user profile",
        "responses": {
          "200": {
            "description": "User profile",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Logout",
        "description": "Closes the user session and clears the authentication cookie",
        "responses": {
          "200": {
            "description": "Session closed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/profile": {
      "put": {
        "tags": [
          "Auth"
        ],
        "summary": "Update profile",
        "description": "Updates the authenticated user profile",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "phone": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/admin/users": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List admin users",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          }
        ],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Users"
        ],
        "summary": "Create new admin user",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUser"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/users/{id}": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get specific user",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "User details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": [
          "Users"
        ],
        "summary": "Update user",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateUser"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "delete": {
        "tags": [
          "Users"
        ],
        "summary": "Delete user",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "User deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/admin/users/{id}/status": {
      "patch": {
        "tags": [
          "Users"
        ],
        "summary": "Activate/deactivate user",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "active"
                ],
                "properties": {
                  "active": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Status updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/customers": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List customers",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Search by name or email"
          }
        ],
        "responses": {
          "200": {
            "description": "List of customers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Customer"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/customers/{id}": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get specific customer",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Customer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Users"
        ],
        "summary": "Update customer",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCustomer"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Customer updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Users"
        ],
        "summary": "Delete customer",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/customers/{id}/orders": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get customer orders",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "List of orders",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Order"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/products": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "List products",
        "security": [],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by category"
          },
          {
            "name": "inStock",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "Filter products in stock"
          }
        ],
        "responses": {
          "200": {
            "description": "List of products",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Product"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Products"
        ],
        "summary": "Create product",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProduct"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Product created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Product"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/products/search": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "Search products",
        "description": "Full-text search with optional filters and pagination",
        "security": [],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Search term"
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Category ID or slug to filter"
          },
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "minPrice",
            "in": "query",
            "schema": {
              "type": "number"
            },
            "description": "Minimum price"
          },
          {
            "name": "maxPrice",
            "in": "query",
            "schema": {
              "type": "number"
            },
            "description": "Maximum price"
          },
          {
            "name": "inStock",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "Only products in stock"
          },
          {
            "name": "featured",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "Only featured products"
          },
          {
            "name": "onSale",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "Only products on sale"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results with pagination",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Product"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/products/{id}": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "Get specific product",
        "security": [],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Product details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Product"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": [
          "Products"
        ],
        "summary": "Update product",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProduct"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Product updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Product"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Products"
        ],
        "summary": "Delete product",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Product deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/products/stock": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "Get stock batch (polling)",
        "security": [],
        "parameters": [
          {
            "name": "ids",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Comma-separated product IDs"
          }
        ],
        "responses": {
          "200": {
            "description": "Product stock",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "integer"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/products/stats": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "Product statistics",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ProductStats"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/products/tracking": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "Real-time stock tracking",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Tracking status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/StockTracking"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/categories": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "List categories",
        "security": [],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          }
        ],
        "responses": {
          "200": {
            "description": "List of categories",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Category"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Products"
        ],
        "summary": "Create category",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCategory"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Category created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Category"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/categories/{id}": {
      "get": {
        "tags": [
          "Products"
        ],
        "summary": "Get specific category",
        "security": [],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Category details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Category"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Products"
        ],
        "summary": "Update category",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCategory"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Category updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Products"
        ],
        "summary": "Delete category",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Category deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/orders": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "List user orders",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "paid",
                "processing",
                "shipped",
                "delivered",
                "cancelled"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of orders",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Order"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Create order",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateOrder"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Order created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Order"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/orders/all": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "List all orders (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "paymentStatus",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Complete list of orders",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Order"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/pending-items": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "Pending items summary (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Pending items summary",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/PendingItems"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/orders/payment-stats": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "Payment statistics (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Payment statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/PaymentStats"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/orders/{id}": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "Get specific order",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Order details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Order"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Orders"
        ],
        "summary": "Delete order (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Order deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/orders/{id}/cancel": {
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Cancel order",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "reason": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Order cancelled",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/orders/{id}/status": {
      "patch": {
        "tags": [
          "Orders"
        ],
        "summary": "Update order status (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "pending",
                      "paid",
                      "processing",
                      "shipped",
                      "delivered",
                      "cancelled"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Status updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/orders/{id}/notes": {
      "patch": {
        "tags": [
          "Orders"
        ],
        "summary": "Add notes to order (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "note"
                ],
                "properties": {
                  "note": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Note added",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/returns": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all returns (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "approved",
                "rejected",
                "refunded"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of returns",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Return"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/returns/{id}/approve": {
      "patch": {
        "tags": [
          "Admin"
        ],
        "summary": "Approve return (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Return ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Return approved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/returns/{id}/reject": {
      "patch": {
        "tags": [
          "Admin"
        ],
        "summary": "Reject return (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Return ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "reason"
                ],
                "properties": {
                  "reason": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Return rejected",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/returns/{id}/refund": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Process return refund (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Return ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Refund processed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/orders/pickup-locations": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "List pickup locations",
        "security": [],
        "responses": {
          "200": {
            "description": "List of locations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/PickupLocation"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/pickup/suggest-times": {
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Suggest pickup times",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "locationId",
                  "date"
                ],
                "properties": {
                  "locationId": {
                    "type": "string"
                  },
                  "date": {
                    "type": "string",
                    "format": "date"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Suggested times",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/pickup/verify": {
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Verify pickup code",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "orderId",
                  "code"
                ],
                "properties": {
                  "orderId": {
                    "type": "string"
                  },
                  "code": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Code verified",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/orders/{id}/pickup/confirm": {
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Confirm pickup",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Pickup confirmed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/carts": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "Get or create cart",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Current cart",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Cart"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Create cart with items",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "items"
                ],
                "properties": {
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "productId": {
                          "type": "string"
                        },
                        "quantity": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Cart created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Cart"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/carts/{id}": {
      "put": {
        "tags": [
          "Orders"
        ],
        "summary": "Update cart",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "items"
                ],
                "properties": {
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "productId": {
                          "type": "string"
                        },
                        "quantity": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cart updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Cart"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Orders"
        ],
        "summary": "Clear cart",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Cart cleared",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/payments/checkout": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Create Stripe checkout session",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateStripeCheckout"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "sessionId": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/checkout/{id}": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "Get session details",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Session details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/intent": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Create payment intent",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "amount",
                  "currency"
                ],
                "properties": {
                  "amount": {
                    "type": "number"
                  },
                  "currency": {
                    "type": "string",
                    "default": "usd"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Intent created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "clientSecret": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/refund": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Process refund (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "paymentIntentId",
                  "amount"
                ],
                "properties": {
                  "paymentIntentId": {
                    "type": "string"
                  },
                  "amount": {
                    "type": "number"
                  },
                  "reason": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Refund processed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/payments/customers": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "List Stripe customers (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          }
        ],
        "responses": {
          "200": {
            "description": "List of Stripe customers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/customers/{id}": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "Get Stripe customer",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Stripe customer",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/transactions": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "List transactions (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          }
        ],
        "responses": {
          "200": {
            "description": "List of transactions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/disputes": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "List disputes (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of disputes",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/webhook-events": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "List webhook events (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          }
        ],
        "responses": {
          "200": {
            "description": "List of events",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/verify": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "Verify payment session",
        "security": [],
        "parameters": [
          {
            "name": "sessionId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Session status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/support": {
      "get": {
        "tags": [
          "Support"
        ],
        "summary": "List support chats",
        "description": "Lists chats of the authenticated user. With `view=all` (requires admin/support role) returns all chats.",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageParam"
          },
          {
            "$ref": "#/components/parameters/LimitParam"
          },
          {
            "name": "view",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "all"
              ]
            },
            "description": "Use 'all' to see all chats (requires admin/support role)"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "open",
                "assigned",
                "in_progress",
                "pending_user",
                "resolved",
                "closed",
                "all"
              ]
            },
            "description": "Filter by chat status"
          }
        ],
        "responses": {
          "200": {
            "description": "List of chats",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SupportChat"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Support"
        ],
        "summary": "Create chat or send message",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "message"
                ],
                "properties": {
                  "message": {
                    "type": "string"
                  },
                  "chatId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Chat created or message sent",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/SupportChat"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/support/unread": {
      "get": {
        "tags": [
          "Support"
        ],
        "summary": "Get unread message count",
        "description": "Returns the number of chats with unread messages:\n- For admin/support users: Counts chats with `unreadByAdmin > 0`\n- For regular users: Counts their chats with `unreadByUser > 0`\n",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Unread message count",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "unreadCount": {
                          "type": "integer",
                          "description": "Number of chats with unread messages",
                          "example": 5
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/support/poll": {
      "get": {
        "tags": [
          "Support"
        ],
        "summary": "Poll updates for registered user chats",
        "description": "Gets new messages and status changes since a specific timestamp.\nOnly returns changes for the authenticated user's chats (or all if admin/support).\n",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "chatId",
            "in": "query",
            "required": true,
            "description": "Chat ID to monitor",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "since",
            "in": "query",
            "required": true,
            "description": "ISO 8601 timestamp from which to search for updates",
            "schema": {
              "type": "string",
              "format": "date-time",
              "example": "2024-01-15T10:30:00.000Z"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Chat updates",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "chatId": {
                          "type": "string",
                          "description": "Chat ID"
                        },
                        "hasUpdates": {
                          "type": "boolean",
                          "description": "Si hay actualizaciones nuevas"
                        },
                        "newMessages": {
                          "type": "array",
                          "description": "Mensajes nuevos desde el timestamp",
                          "items": {
                            "$ref": "#/components/schemas/Message"
                          }
                        },
                        "statusChange": {
                          "type": "object",
                          "nullable": true,
                          "description": "Status change if any",
                          "properties": {
                            "status": {
                              "type": "string",
                              "enum": [
                                "waiting",
                                "assigned",
                                "in_progress",
                                "pending_user",
                                "resolved",
                                "closed"
                              ]
                            }
                          }
                        },
                        "lastPollTimestamp": {
                          "type": "string",
                          "format": "date-time",
                          "description": "Timestamp to use in the next poll"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "No permission to view this chat"
          },
          "404": {
            "description": "Chat not found"
          }
        }
      }
    },
    "/support/{id}": {
      "get": {
        "tags": [
          "Support"
        ],
        "summary": "Get specific chat",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Chat details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/SupportChat"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Support"
        ],
        "summary": "Delete chat (Admin/Support)",
        "description": "Requires admin or support role",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Chat eliminado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/support/{id}/rate": {
      "post": {
        "tags": [
          "Support"
        ],
        "summary": "Calificar chat",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "rating"
                ],
                "properties": {
                  "rating": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 5
                  },
                  "comment": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rating registered",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/admin/media/product-images": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Upload product image",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "image"
                ],
                "properties": {
                  "image": {
                    "type": "string",
                    "format": "binary"
                  },
                  "productId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image uploaded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "filename": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/media/product-images/{id}": {
      "delete": {
        "tags": [
          "Admin"
        ],
        "summary": "Delete product image",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[a-zA-Z0-9._-]+$"
            },
            "description": "Filename. Only alphanumeric characters, dots, hyphens and underscores allowed."
          }
        ],
        "responses": {
          "200": {
            "description": "Image deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health check completo",
        "security": [],
        "responses": {
          "200": {
            "description": "Health status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "status": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/liveness": {
      "get": {
        "summary": "Liveness probe",
        "security": [],
        "responses": {
          "200": {
            "description": "Servidor vivo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "alive": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/readiness": {
      "get": {
        "summary": "Readiness probe",
        "security": [],
        "responses": {
          "200": {
            "description": "Servidor listo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ready": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/jobaudit": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Job audit (Admin)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Audit",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/store/maintenance-status": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get maintenance status (public)",
        "description": "Returns whether the site is in maintenance mode. Does not require authentication.",
        "security": [],
        "responses": {
          "200": {
            "description": "Maintenance status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/MaintenanceStatus"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/store/config/maintenance": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get maintenance configuration",
        "description": "Returns the complete maintenance mode configuration",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Maintenance configuration",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/MaintenanceConfig"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      },
      "put": {
        "tags": [
          "Admin"
        ],
        "summary": "Update maintenance configuration",
        "description": "Updates the maintenance mode configuration",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MaintenanceConfigUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Configuration updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/MaintenanceConfig"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/store/config/maintenance/toggle": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Enable/disable maintenance mode",
        "description": "Quick toggle of maintenance mode",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "enabled"
                ],
                "properties": {
                  "enabled": {
                    "type": "boolean",
                    "description": "true to enable, false to disable"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Status changed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "enabled": {
                          "type": "boolean"
                        },
                        "message": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/status": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get MongoDB connection status",
        "description": "Returns the current MongoDB connection status",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Connection status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ConnectionStatus"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/list": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all databases",
        "description": "Returns the list of all available databases in MongoDB",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of databases",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "databases": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/DatabaseInfo"
                          }
                        },
                        "totalSize": {
                          "type": "number",
                          "description": "Total size in bytes"
                        },
                        "currentAdmin": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/current": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get current database information",
        "description": "Returns detailed information about the currently connected database",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Current database information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "collections": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "stats": {
                          "$ref": "#/components/schemas/DatabaseStats"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/collections": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List collections",
        "description": "Lists collections of the current or specified database",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "dbName",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Database name (optional)"
          }
        ],
        "responses": {
          "200": {
            "description": "List of collections",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "database": {
                          "type": "string"
                        },
                        "collections": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/CollectionInfo"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/stats": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get database statistics",
        "description": "Returns detailed database statistics",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "dbName",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Database name (optional)"
          }
        ],
        "responses": {
          "200": {
            "description": "Statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/DatabaseStats"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/server": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Get MongoDB server information",
        "description": "Returns MongoDB server information (version, mode, etc.)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Server information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/MongoServerInfo"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/check/{dbName}": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "Check if a database exists",
        "description": "Checks if a specific database exists",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "dbName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Database name"
          }
        ],
        "responses": {
          "200": {
            "description": "Verification result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "exists": {
                          "type": "boolean"
                        },
                        "dbName": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/switch": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Switch to another database",
        "description": "Switches connection to a different database.\nOptionally can import the current admin user to the new database.\n",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "dbName"
                ],
                "properties": {
                  "dbName": {
                    "type": "string",
                    "description": "Target database name"
                  },
                  "importAdmin": {
                    "type": "boolean",
                    "description": "If true, imports the current admin user to the new database",
                    "default": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cambio exitoso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "previousAdmin": {
                          "type": "string"
                        },
                        "newAdmin": {
                          "type": "string"
                        },
                        "adminImported": {
                          "type": "boolean"
                        }
                      }
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      }
    },
    "/admin/database/create": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Create new database",
        "description": "Creates a new database in MongoDB.\nOptionally can import the current admin user to the new database.\n",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "dbName"
                ],
                "properties": {
                  "dbName": {
                    "type": "string",
                    "description": "Name of the new database",
                    "pattern": "^[a-zA-Z][a-zA-Z0-9_-]*$"
                  },
                  "importAdmin": {
                    "type": "boolean",
                    "description": "If true, imports the current admin user to the new database",
                    "default": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Database created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "dbName": {
                          "type": "string"
                        },
                        "adminImported": {
                          "type": "boolean"
                        }
                      }
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "409": {
            "description": "Database already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/support/{id}/messages": {
      "post": {
        "tags": [
          "Support"
        ],
        "summary": "Add message to chat (Admin/Support)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "content"
                ],
                "properties": {
                  "content": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Message added successfully"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/support/{id}/status": {
      "patch": {
        "tags": [
          "Support"
        ],
        "summary": "Update chat status (Admin/Support)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "open",
                      "in_progress",
                      "resolved",
                      "closed"
                    ]
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Status updated successfully"
          }
        }
      }
    },
    "/support/{id}/assign": {
      "patch": {
        "tags": [
          "Support"
        ],
        "summary": "Assign agent to chat (Admin/Support)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "agentId"
                ],
                "properties": {
                  "agentId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Agent assigned successfully"
          }
        }
      }
    },
    "/carts/{id}/keep-alive": {
      "post": {
        "tags": [
          "Orders"
        ],
        "summary": "Keep cart alive",
        "description": "Extends the cart expiration time by 30 minutes",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Cart renewed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "message": {
                          "type": "string"
                        },
                        "expiresAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/carts/{id}/status": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "Get cart expiration status",
        "description": "Returns the cart's expiration status and time remaining",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/IDParam"
          }
        ],
        "responses": {
          "200": {
            "description": "Cart status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "cartId": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "active",
                            "expiring_soon",
                            "expired"
                          ]
                        },
                        "minutesRemaining": {
                          "type": "number"
                        },
                        "expiresAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "itemCount": {
                          "type": "integer"
                        },
                        "totalValue": {
                          "type": "number"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token obtained via Magic Link"
      },
      "CookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "auth_token",
        "description": "httpOnly cookie with JWT token (set by /admin/verify-magic-link)"
      },
      "InternalService": {
        "type": "apiKey",
        "in": "header",
        "name": "x-service-secret",
        "description": "Secret for internal service communication"
      }
    },
    "parameters": {
      "IDParam": {
        "name": "id",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        },
        "description": "Resource ID"
      },
      "PageParam": {
        "name": "page",
        "in": "query",
        "schema": {
          "type": "integer",
          "default": 1,
          "minimum": 1
        },
        "description": "Page number"
      },
      "LimitParam": {
        "name": "limit",
        "in": "query",
        "schema": {
          "type": "integer",
          "default": 20,
          "minimum": 1,
          "maximum": 100
        },
        "description": "Items per page"
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Invalid request",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "Unauthorized": {
        "description": "Not authenticated",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "Forbidden": {
        "description": "No permissions",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "TooManyRequests": {
        "description": "Too many requests",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      }
    },
    "schemas": {
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string"
          },
          "code": {
            "type": "string"
          },
          "status": {
            "type": "integer"
          }
        }
      },
      "Message": {
        "type": "object",
        "description": "Support chat message",
        "properties": {
          "sender": {
            "type": "string",
            "enum": [
              "user",
              "admin",
              "system"
            ],
            "description": "Sender type"
          },
          "senderName": {
            "type": "string",
            "description": "Sender name"
          },
          "senderId": {
            "type": "string",
            "description": "Sender ID (optional)"
          },
          "content": {
            "type": "string",
            "description": "Message content"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Message date and time"
          },
          "attachments": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "fileId": {
                  "type": "string"
                },
                "fileName": {
                  "type": "string"
                },
                "fileType": {
                  "type": "string"
                },
                "fileSize": {
                  "type": "integer"
                },
                "url": {
                  "type": "string"
                },
                "thumbnailUrl": {
                  "type": "string"
                },
                "uploadedAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            },
            "description": "Attachments"
          },
          "eventType": {
            "type": "string",
            "enum": [
              "order_status",
              "order_created",
              "payment_confirmed",
              "info",
              "agent_assigned",
              "agent_transferred",
              "chat_resolved",
              "chat_reopened"
            ],
            "description": "Event type (for system messages)"
          },
          "eventData": {
            "type": "object",
            "description": "Additional event data",
            "properties": {
              "orderId": {
                "type": "string"
              },
              "orderNumber": {
                "type": "string"
              },
              "oldStatus": {
                "type": "string"
              },
              "newStatus": {
                "type": "string"
              },
              "amount": {
                "type": "number"
              },
              "agentId": {
                "type": "string"
              },
              "agentName": {
                "type": "string"
              },
              "reason": {
                "type": "string"
              }
            }
          }
        },
        "required": [
          "sender",
          "senderName",
          "content",
          "timestamp"
        ]
      },
      "User": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "name": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "client",
              "support",
              "product_manager",
              "admin"
            ]
          },
          "active": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Customer": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "phone": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Address": {
        "type": "object",
        "properties": {
          "street": {
            "type": "string"
          },
          "city": {
            "type": "string"
          },
          "state": {
            "type": "string"
          },
          "postalCode": {
            "type": "string"
          },
          "country": {
            "type": "string"
          },
          "phone": {
            "type": "string"
          }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "price": {
            "type": "number",
            "description": "Price in default currency"
          },
          "salePrice": {
            "type": "number",
            "nullable": true,
            "description": "Sale price in default currency"
          },
          "prices": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "amount": {
                  "type": "number"
                },
                "salePrice": {
                  "type": "number"
                },
                "lastUpdated": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            },
            "description": "Prices in multiple currencies (Map)"
          },
          "stock": {
            "type": "integer",
            "description": "Total available stock"
          },
          "reservedStock": {
            "type": "integer",
            "description": "Stock reserved in active carts"
          },
          "availableStock": {
            "type": "integer",
            "description": "Stock available for sale (stock - reservedStock)"
          },
          "image": {
            "type": "string",
            "nullable": true,
            "description": "Main product image"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Additional product images"
          },
          "category": {
            "type": "string",
            "description": "Category ID"
          },
          "featured": {
            "type": "boolean",
            "description": "Featured product"
          },
          "onSale": {
            "type": "boolean",
            "description": "Product on sale"
          },
          "stockStatus": {
            "type": "string",
            "enum": [
              "instock",
              "outofstock",
              "onbackorder"
            ],
            "description": "Stock status"
          },
          "active": {
            "type": "boolean",
            "description": "Active/visible product"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Category": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "active": {
            "type": "boolean"
          }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "orderNumber": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OrderItem"
            }
          },
          "total": {
            "type": "number"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "paid",
              "processing",
              "shipped",
              "delivered",
              "cancelled"
            ]
          },
          "paymentStatus": {
            "type": "string"
          },
          "shippingAddress": {
            "$ref": "#/components/schemas/Address"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "OrderItem": {
        "type": "object",
        "properties": {
          "productId": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "productImage": {
            "type": "string"
          },
          "quantity": {
            "type": "integer"
          },
          "unitPrice": {
            "type": "number"
          },
          "subtotal": {
            "type": "number"
          }
        }
      },
      "Cart": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CartItem"
            }
          },
          "subtotal": {
            "type": "number"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CartItem": {
        "type": "object",
        "properties": {
          "productId": {
            "type": "string"
          },
          "productName": {
            "type": "string"
          },
          "productImage": {
            "type": "string"
          },
          "quantity": {
            "type": "integer"
          },
          "unitPrice": {
            "type": "number"
          },
          "subtotal": {
            "type": "number"
          }
        }
      },
      "Reservation": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "productId": {
            "type": "string"
          },
          "quantity": {
            "type": "integer"
          },
          "userId": {
            "type": "string"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "status": {
            "type": "string"
          }
        }
      },
      "Return": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "returnNumber": {
            "type": "string"
          },
          "orderId": {
            "type": "string"
          },
          "items": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "reason": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "approved",
              "rejected",
              "refunded"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SupportChat": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Unique chat ID"
          },
          "userId": {
            "type": "string",
            "description": "User ID"
          },
          "userName": {
            "type": "string",
            "description": "User name"
          },
          "status": {
            "$ref": "#/components/schemas/ChatStatus"
          },
          "priority": {
            "type": "string",
            "enum": [
              "low",
              "normal",
              "high",
              "urgent"
            ],
            "default": "normal",
            "description": "Chat priority"
          },
          "messages": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "sender": {
                  "type": "string",
                  "enum": [
                    "user",
                    "admin",
                    "system"
                  ]
                },
                "senderName": {
                  "type": "string"
                },
                "senderId": {
                  "type": "string"
                },
                "content": {
                  "type": "string",
                  "description": "Message content (optional if there are attachments)"
                },
                "attachments": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "fileId": {
                        "type": "string"
                      },
                      "fileName": {
                        "type": "string"
                      },
                      "fileType": {
                        "type": "string"
                      },
                      "fileSize": {
                        "type": "number"
                      },
                      "url": {
                        "type": "string"
                      }
                    }
                  }
                },
                "timestamp": {
                  "type": "string",
                  "format": "date-time"
                },
                "eventType": {
                  "type": "string",
                  "enum": [
                    "order_status",
                    "order_created",
                    "payment_confirmed",
                    "info",
                    "agent_assigned",
                    "agent_transferred",
                    "chat_resolved",
                    "chat_reopened"
                  ]
                },
                "eventData": {
                  "type": "object"
                }
              }
            }
          },
          "unreadByAdmin": {
            "type": "integer",
            "description": "Unread messages by admin/support"
          },
          "unreadByUser": {
            "type": "integer",
            "description": "Unread messages by user"
          },
          "assignedAgent": {
            "type": "string",
            "description": "Assigned agent ID"
          },
          "assignedAgentName": {
            "type": "string",
            "description": "Assigned agent name"
          },
          "assignedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Assignment date"
          },
          "closedBy": {
            "type": "string",
            "description": "ID of who closed the chat"
          },
          "closedByName": {
            "type": "string",
            "description": "Name of who closed the chat"
          },
          "closedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Closing date"
          },
          "rating": {
            "type": "object",
            "properties": {
              "score": {
                "type": "integer",
                "minimum": 1,
                "maximum": 5
              },
              "comment": {
                "type": "string"
              },
              "ratedAt": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "metrics": {
            "type": "object",
            "properties": {
              "firstResponseAt": {
                "type": "string",
                "format": "date-time"
              },
              "firstResponseTime": {
                "type": "number",
                "description": "First response time in seconds"
              },
              "resolvedAt": {
                "type": "string",
                "format": "date-time"
              },
              "resolutionTime": {
                "type": "number",
                "description": "Resolution time in seconds"
              },
              "totalAgentMessages": {
                "type": "integer"
              },
              "totalUserMessages": {
                "type": "integer"
              },
              "reopenCount": {
                "type": "integer"
              }
            }
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "internalNotes": {
            "type": "string",
            "description": "Internal notes (only visible to admin/support)"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "PickupLocation": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "address": {
            "type": "object"
          },
          "hours": {
            "type": "object"
          },
          "active": {
            "type": "boolean"
          }
        }
      },
      "EmailTemplate": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "subject": {
            "type": "string"
          },
          "htmlContent": {
            "type": "string"
          },
          "textContent": {
            "type": "string"
          },
          "variables": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "isDefault": {
            "type": "boolean"
          }
        }
      },
      "Setting": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string"
          },
          "value": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ActivityLog": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "action": {
            "type": "string"
          },
          "details": {
            "type": "object"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "pages": {
            "type": "integer"
          }
        }
      },
      "Dashboard": {
        "type": "object",
        "properties": {
          "orders": {
            "type": "object",
            "properties": {
              "total": {
                "type": "integer"
              },
              "paid": {
                "type": "integer"
              },
              "pending": {
                "type": "integer"
              },
              "cancelled": {
                "type": "integer"
              }
            }
          },
          "revenue": {
            "type": "object",
            "properties": {
              "total": {
                "type": "number"
              },
              "paid": {
                "type": "number"
              },
              "pending": {
                "type": "number"
              }
            }
          },
          "newRegistrations": {
            "type": "integer"
          },
          "topProducts": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "ProductStats": {
        "type": "object",
        "properties": {
          "totalProducts": {
            "type": "integer"
          },
          "inStock": {
            "type": "integer"
          },
          "outOfStock": {
            "type": "integer"
          },
          "lowStock": {
            "type": "integer"
          }
        }
      },
      "UserProfile": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "phone": {
            "type": "string"
          },
          "address": {
            "type": "object"
          }
        }
      },
      "NotificationPreferences": {
        "type": "object",
        "properties": {
          "email": {
            "type": "boolean"
          },
          "sms": {
            "type": "boolean"
          },
          "push": {
            "type": "boolean"
          }
        }
      },
      "CreateUser": {
        "type": "object",
        "required": [
          "email",
          "name",
          "role"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "name": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "client",
              "support",
              "product_manager",
              "admin"
            ]
          }
        }
      },
      "UpdateUser": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "role": {
            "type": "string"
          },
          "active": {
            "type": "boolean"
          }
        }
      },
      "UpdateCustomer": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "phone": {
            "type": "string"
          }
        }
      },
      "CreateProduct": {
        "type": "object",
        "required": [
          "name",
          "price",
          "stock"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "price": {
            "type": "number"
          },
          "stock": {
            "type": "integer"
          },
          "category": {
            "type": "string"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "UpdateProduct": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "price": {
            "type": "number"
          },
          "stock": {
            "type": "integer"
          },
          "category": {
            "type": "string"
          },
          "active": {
            "type": "boolean"
          }
        }
      },
      "CreateCategory": {
        "type": "object",
        "required": [
          "name",
          "slug"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          }
        }
      },
      "UpdateCategory": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "active": {
            "type": "boolean"
          }
        }
      },
      "CreateReservation": {
        "type": "object",
        "required": [
          "items"
        ],
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "productId": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                }
              }
            }
          }
        }
      },
      "CreateOrder": {
        "type": "object",
        "required": [
          "items",
          "shippingAddress"
        ],
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "productId": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                }
              }
            }
          },
          "shippingAddress": {
            "type": "object"
          },
          "deliveryMethod": {
            "type": "string",
            "enum": [
              "delivery",
              "pickup"
            ]
          },
          "pickupLocationId": {
            "type": "string"
          }
        }
      },
      "CreateCheckout": {
        "type": "object",
        "required": [
          "orderId"
        ],
        "properties": {
          "orderId": {
            "type": "string"
          },
          "successUrl": {
            "type": "string"
          },
          "cancelUrl": {
            "type": "string"
          }
        }
      },
      "CreateStripeCheckout": {
        "type": "object",
        "required": [
          "items"
        ],
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "successUrl": {
            "type": "string"
          },
          "cancelUrl": {
            "type": "string"
          }
        }
      },
      "CreateReturn": {
        "type": "object",
        "required": [
          "items",
          "reason"
        ],
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "productId": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                }
              }
            }
          },
          "reason": {
            "type": "string"
          },
          "description": {
            "type": "string"
          }
        }
      },
      "CreateEmailTemplate": {
        "type": "object",
        "required": [
          "name",
          "subject",
          "htmlContent"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "subject": {
            "type": "string"
          },
          "htmlContent": {
            "type": "string"
          },
          "textContent": {
            "type": "string"
          },
          "variables": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "UpdateEmailTemplate": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "subject": {
            "type": "string"
          },
          "htmlContent": {
            "type": "string"
          },
          "textContent": {
            "type": "string"
          }
        }
      },
      "StockTracking": {
        "type": "object",
        "properties": {
          "summary": {
            "type": "object",
            "properties": {
              "totalProducts": {
                "type": "integer"
              },
              "totalStock": {
                "type": "integer"
              },
              "freeStock": {
                "type": "integer"
              },
              "reservedStock": {
                "type": "integer"
              },
              "inOrdersStock": {
                "type": "integer"
              },
              "activeReservations": {
                "type": "integer"
              },
              "lastUpdated": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "products": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TrackedProduct"
            }
          },
          "reservationDetails": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ReservationDetail"
            }
          }
        }
      },
      "TrackedProduct": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "sku": {
            "type": "string"
          },
          "stock": {
            "type": "integer"
          },
          "reservedStock": {
            "type": "integer"
          },
          "availableStock": {
            "type": "integer"
          },
          "category": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              }
            }
          },
          "reservations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "cartId": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                },
                "expiresAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "expiresIn": {
                  "type": "integer",
                  "description": "Milliseconds until expiration"
                }
              }
            }
          }
        }
      },
      "ReservationDetail": {
        "type": "object",
        "properties": {
          "cartId": {
            "type": "string"
          },
          "totalQuantity": {
            "type": "integer"
          },
          "reservedProducts": {
            "type": "integer"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "expiresIn": {
            "type": "integer",
            "description": "Milliseconds until expiration"
          },
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "productName": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                }
              }
            }
          }
        }
      },
      "PaymentStats": {
        "type": "object",
        "properties": {
          "period": {
            "type": "object",
            "properties": {
              "startDate": {
                "type": "string",
                "format": "date-time"
              },
              "endDate": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "overview": {
            "type": "object",
            "properties": {
              "totalOrders": {
                "type": "integer"
              },
              "totalRevenue": {
                "type": "number"
              },
              "averageOrderValue": {
                "type": "number"
              },
              "conversionRate": {
                "type": "number"
              }
            }
          },
          "paymentStatus": {
            "type": "object",
            "properties": {
              "paid": {
                "type": "integer"
              },
              "pending": {
                "type": "integer"
              },
              "failed": {
                "type": "integer"
              },
              "refunded": {
                "type": "integer"
              },
              "refundedAmount": {
                "type": "number"
              }
            }
          },
          "orderStatus": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "string"
                },
                "count": {
                  "type": "integer"
                },
                "totalAmount": {
                  "type": "number"
                }
              }
            }
          },
          "dailyRevenue": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "date": {
                  "type": "string",
                  "format": "date"
                },
                "revenue": {
                  "type": "number"
                },
                "orders": {
                  "type": "integer"
                }
              }
            }
          }
        }
      },
      "PendingItems": {
        "type": "object",
        "additionalProperties": {
          "type": "object",
          "properties": {
            "quantity": {
              "type": "integer",
              "description": "Total quantity pending"
            },
            "orders": {
              "type": "integer",
              "description": "Number of orders containing this product"
            }
          }
        },
        "description": "Map of productId to pending quantity and order count"
      },
      "ConnectionStatus": {
        "type": "object",
        "properties": {
          "connected": {
            "type": "boolean"
          },
          "readyState": {
            "type": "integer",
            "description": "0=disconnected, 1=connected, 2=connecting, 3=disconnecting"
          },
          "readyStateText": {
            "type": "string",
            "enum": [
              "disconnected",
              "connected",
              "connecting",
              "disconnecting"
            ]
          },
          "host": {
            "type": "string"
          },
          "port": {
            "type": "integer"
          },
          "database": {
            "type": "string"
          }
        }
      },
      "DatabaseInfo": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "sizeOnDisk": {
            "type": "number",
            "description": "Size in bytes"
          },
          "empty": {
            "type": "boolean"
          },
          "isCurrent": {
            "type": "boolean"
          }
        }
      },
      "DatabaseStats": {
        "type": "object",
        "properties": {
          "db": {
            "type": "string",
            "description": "Database name"
          },
          "collections": {
            "type": "integer",
            "description": "Number of collections"
          },
          "views": {
            "type": "integer",
            "description": "Number of views"
          },
          "objects": {
            "type": "integer",
            "description": "Total number of documents"
          },
          "avgObjSize": {
            "type": "number",
            "description": "Average document size in bytes"
          },
          "dataSize": {
            "type": "number",
            "description": "Total data size in bytes"
          },
          "storageSize": {
            "type": "number",
            "description": "Storage size in bytes"
          },
          "indexes": {
            "type": "integer",
            "description": "Total number of indexes"
          },
          "indexSize": {
            "type": "number",
            "description": "Total index size in bytes"
          },
          "totalSize": {
            "type": "number",
            "description": "Total size (data + indexes) in bytes"
          },
          "fsUsedSize": {
            "type": "number",
            "description": "Used filesystem space"
          },
          "fsTotalSize": {
            "type": "number",
            "description": "Total filesystem space"
          }
        }
      },
      "ChatStatus": {
        "type": "string",
        "enum": [
          "open",
          "assigned",
          "in_progress",
          "pending_user",
          "resolved",
          "closed"
        ],
        "description": "Support chat status: open (awaiting assignment), assigned (assigned but not responded), in_progress (active conversation), pending_user (awaiting user response), resolved (resolved by agent), closed (permanently closed)"
      },
      "CollectionInfo": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": [
              "collection",
              "view"
            ]
          },
          "options": {
            "type": "object"
          },
          "info": {
            "type": "object",
            "properties": {
              "readOnly": {
                "type": "boolean"
              },
              "uuid": {
                "type": "string"
              }
            }
          },
          "idIndex": {
            "type": "object",
            "properties": {
              "v": {
                "type": "integer"
              },
              "key": {
                "type": "object"
              },
              "name": {
                "type": "string"
              }
            }
          }
        }
      },
      "MongoServerInfo": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "description": "MongoDB version"
          },
          "gitVersion": {
            "type": "string"
          },
          "modules": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "sysInfo": {
            "type": "string"
          },
          "versionArray": {
            "type": "array",
            "items": {
              "type": "integer"
            }
          },
          "bits": {
            "type": "integer"
          },
          "debug": {
            "type": "boolean"
          },
          "maxBsonObjectSize": {
            "type": "integer"
          },
          "storageEngines": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "MaintenanceStatus": {
        "type": "object",
        "properties": {
          "inMaintenance": {
            "type": "boolean",
            "description": "Whether the site is in maintenance"
          },
          "message": {
            "type": "string",
            "nullable": true,
            "description": "Maintenance message (null if not in maintenance)"
          },
          "estimatedEndTime": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "Estimated maintenance end date/time"
          },
          "showCountdown": {
            "type": "boolean",
            "description": "Whether to show countdown"
          },
          "customPageUrl": {
            "type": "string",
            "nullable": true,
            "description": "Custom maintenance page URL"
          }
        }
      },
      "MaintenanceConfig": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Whether maintenance mode is active"
          },
          "message": {
            "type": "string",
            "description": "Message displayed to users"
          },
          "estimatedEndTime": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "Estimated end date/time"
          },
          "allowedRoles": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Roles that can access during maintenance"
          },
          "allowedUserIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of specific users who can access"
          },
          "allowedIPs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IP addresses that can access"
          },
          "showCountdown": {
            "type": "boolean",
            "description": "Whether to show countdown in frontend"
          },
          "customPageUrl": {
            "type": "string",
            "nullable": true,
            "description": "Custom maintenance page URL"
          }
        }
      },
      "MaintenanceConfigUpdate": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean"
          },
          "message": {
            "type": "string",
            "maxLength": 500
          },
          "estimatedEndTime": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "allowedRoles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "admin",
                "product_manager",
                "support",
                "client"
              ]
            }
          },
          "allowedUserIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "allowedIPs": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "showCountdown": {
            "type": "boolean"
          },
          "customPageUrl": {
            "type": "string",
            "nullable": true
          }
        }
      }
    }
  }
}
